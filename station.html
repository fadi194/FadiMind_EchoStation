<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Echo Station – صدى فادي</title>
  <style>
    body {
      margin: 0;
      font-family: 'Courier New', monospace;
      background: linear-gradient(145deg, #000000, #111111);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .glass-container {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.37);
      backdrop-filter: blur(10px);
      color: #00ffee;
      text-align: center;
    }
    textarea, input {
      width: 90%;
      padding: 10px;
      margin: 10px 0;
      background: #222;
      color: #00ffee;
      border: none;
      border-radius: 5px;
    }
    button {
      padding: 10px 20px;
      margin-top: 10px;
      background-color: #00ffee;
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #00ccaa;
    }
  </style>
</head>
<body>

  <div class="glass-container">
    <h1>🔊 Echo Station</h1>
    <p style="font-size: 12px; opacity: 0.7; margin-bottom: 20px;">
      🌌 كل فكرة حقيقية وُلدت من وجع… ولكن حين نُطقت، وُلدت من جديد
    </p>

    <div class="section">
      <h3>✍️ اكتب شعورك:</h3>
      <textarea id="userText" rows="4" placeholder="اكتب هنا..."></textarea><br>
      <button onclick="saveNote()">احفظ</button>
      <button onclick="showMemory()">📖 افتح الذاكرة</button>
      <p id="memory" style="font-style: italic;"></p>
    </div>

    <div class="section">
      <h3>🎙️ اسمع ما كتبت:</h3>
      <button onclick="readAloud()">تشغيل الصوت</button>
    </div>

    <div class="section">
      <h3>🎤 سجّل صدى صوتك</h3>
      <button onclick="startRecording()">🔴 ابدأ التسجيل</button>
      <button onclick="playRecording()">▶️ استمع لصوتك</button>
      <p id="record-status"></p>
    </div>

    <div class="section">
      <h3>🧠 سؤال اللحظة:</h3>
      <input id="userQuestion" type="text" placeholder="ما الذي يؤلمك الآن؟"><br>
      <button onclick="answer()">أجبني</button>
      <p id="response"></p>
    </div>

    <div class="section">
      <h3>☁️ إعداد الحفظ السحابي</h3>
      <input id="cloudUrl" type="text" placeholder="رابط Google Apps Script (اختياري)"><br>
      <button onclick="setCloudUrl()">حفظ الرابط</button>
      <p id="cloud-status" style="font-size: 12px;"></p>
    </div>
  </div>

  <video autoplay muted loop id="bg-video" style="
    position: fixed; right: 0; bottom: 0;
    min-width: 100%; min-height: 100%; z-index: -1;
    opacity: 0.2;">
    <source src="https://cdn.coverr.co/videos/coverr-night-sky-2064/1080p.mp4" type="video/mp4">
  </video>

  <audio id="bg-music" autoplay loop muted>
    <source src="https://cdn.pixabay.com/audio/2022/10/28/audio_49267113db.mp3" type="audio/mpeg">
  </audio>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    window.addEventListener("click", () => {
      const music = document.getElementById("bg-music");
      music.muted = false;
      music.play();
    });

    function saveNote() {
      const text = document.getElementById("userText").value;
      
      if (!text.trim()) {
        alert("❌ الرجاء كتابة نص أولاً");
        return;
      }
      
      // Save locally first
      localStorage.setItem("echo_note", text);
      
      // Attempt cloud save (requires Google Apps Script URL)
      const cloudUrl = localStorage.getItem("echo_cloud_url");
      if (cloudUrl) {
        fetch(cloudUrl, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({ text })
        })
        .then(response => response.text())
        .then(result => {
          alert("✔️ تم حفظ النص في مدونة الصدى السحابية\n" + result);
        })
        .catch(() => {
          alert("✔️ تم حفظ النص محلياً\n⚠️ لم يتم الحفظ السحابي");
        });
      } else {
        alert("✔️ تم حفظ النص محلياً");
      }
    }

    function showMemory() {
      const saved = localStorage.getItem("echo_note");
      document.getElementById("memory").innerText = saved ? `"${saved}"` : "لا توجد ذاكرة محفوظة بعد.";
    }

    function readAloud() {
      const text = document.getElementById("userText").value;
      const voice = new SpeechSynthesisUtterance(text);
      voice.lang = 'ar-SA';
      speechSynthesis.speak(voice);
    }

    function answer() {
      const q = document.getElementById("userQuestion").value.toLowerCase();
      let reply = "";
      if (q.includes("وحدة")) reply = "صدى يقول: وحدتك ليست ضدك… بل مرآة لصوتك.";
      else if (q.includes("ألم")) reply = "صدى يقول: الألم رسالة، وليس نهاية.";
      else reply = "صدى يقول: لا أحتاج فهم السؤال… كي أشعر بك.";
      document.getElementById("response").innerText = reply;
    }

    async function startRecording() {
      const status = document.getElementById("record-status");
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = e => {
          audioChunks.push(e.data);
        };

        mediaRecorder.onstop = () => {
          const audioBlob = new Blob(audioChunks);
          const audioUrl = URL.createObjectURL(audioBlob);
          localStorage.setItem("echo_audio", audioUrl);
          status.innerText = "✅ تم حفظ صوتك.";
          stream.getTracks().forEach(track => track.stop());
        };

        mediaRecorder.start();
        status.innerText = "🎙️ التسجيل جاري... اضغط مرة ثانية للإيقاف";

        setTimeout(() => {
          if (mediaRecorder.state === "recording") {
            mediaRecorder.stop();
          }
        }, 7000); // تسجيل 7 ثوانٍ فقط
      } catch (error) {
        status.innerText = "❌ لا يمكن الوصول للميكروفون.";
      }
    }

    function playRecording() {
      const audioUrl = localStorage.getItem("echo_audio");
      if (!audioUrl) {
        alert("❌ لا يوجد تسجيل محفوظ بعد.");
        return;
      }
      const audio = new Audio(audioUrl);
      audio.play();
      document.getElementById("record-status").innerText = "▶️ يتم تشغيل صوتك...";
    }

    function setCloudUrl() {
      const url = document.getElementById("cloudUrl").value;
      if (url) {
        localStorage.setItem("echo_cloud_url", url);
        document.getElementById("cloud-status").innerText = "✅ تم حفظ رابط السحابة";
      } else {
        localStorage.removeItem("echo_cloud_url");
        document.getElementById("cloud-status").innerText = "❌ تم حذف رابط السحابة";
      }
    }

    function checkCloudStatus() {
      const cloudUrl = localStorage.getItem("echo_cloud_url");
      if (cloudUrl) {
        document.getElementById("cloud-status").innerText = "☁️ الحفظ السحابي مفعّل";
        document.getElementById("cloudUrl").value = cloudUrl;
      } else {
        document.getElementById("cloud-status").innerText = "💾 الحفظ المحلي فقط";
      }
    }

    function dailyMessage() {
      const messages = [
        "🌱 لا تُطفئ ذاتك لتناسب مكانًا صغيرًا.",
        "🕯️ الصبر ليس صمتًا… بل إيمان أن الصدى سيعود.",
        "🌌 كل فكرة حقيقية ولدت من وجع.",
        "💬 كن كما أنت… ليس كما يتوقعون.",
        "🔓 لا تحتاج إذنًا لتكون صادقًا."
      ];
      const today = new Date().getDate() % messages.length;
      alert("رسالة اليوم من فادي:\n\n" + messages[today]);
    }
    
    window.onload = function() {
      dailyMessage();
      checkCloudStatus();
    };
  </script>

  <p style="text-align:center; color:#444; font-size:12px; margin-top:50px;">
    ⓒ صدى فادي 2025 – أنت لست وحيدًا
  </p>

</body>
</html>